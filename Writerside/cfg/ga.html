<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NP81XGWTMP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NP81XGWTMP');
</script>
<!--<script async-->
<!--        src="https://agent-aee6a811e474080613b1-ie5yg.ondigitalocean.app/static/chatbot/widget.js"-->
<!--        data-agent-id="1150ab95-025b-11f0-bf8f-4e013e2ddde4"-->
<!--        data-chatbot-id="JrYZtArj_C5FGRts06op58QUHPFCgUzo"-->
<!--        data-name="WGDashboard Doc Chatbot"-->
<!--        data-primary-color="#009dff"-->
<!--        data-secondary-color="#ff875b"-->
<!--        data-button-background-color="#ff875b"-->
<!--        data-starting-message="Hello! How can I help you today?"-->
<!--        data-logo="/static/chatbot/icons/default-agent.svg">-->
<!--</script>-->

<script async>
  // Get config from current script tag data attrs
function initGenAiChatbot() {
  let genaiWidgetScript = document.currentScript;

  let API_URL = undefined;

  if (!API_URL) {
    const parsedUrl = new URL("https://agent-aee6a811e474080613b1-ie5yg.ondigitalocean.app/static/chatbot/widget.js");
    API_URL = `${parsedUrl.protocol}//${parsedUrl.host}`;
  }

  const config = {
    API_URL,
    API_KEY: "JrYZtArj_C5FGRts06op58QUHPFCgUzo",
    AGENT_ID: "1150ab95-025b-11f0-bf8f-4e013e2ddde4",
    AGENT_NAME: "WGDashboard Doc Chatbot",
    PRIMARY_COLOR: "#009dff",
    SECONDARY_COLOR: "#ff875b",
    LOGO: "https://raw.githubusercontent.com/donaldzou/WGDashboard-Documentation/refs/heads/main/Writerside/images/Chat.png",
    STARTING_MESSAGE: "Hello! How can I help you today?",
    BUTTON_BACKGROUND_COLOR: "#ff875b",
    BUTTON_TEXT_COLOR: undefined,
    RENDER_TARGET_ID: "",
  };

  // Inject config into iframe src
  const scriptUrl = new URL("https://agent-aee6a811e474080613b1-ie5yg.ondigitalocean.app/static/chatbot/widget.js");
  const origin = scriptUrl.origin;
  const url = `${origin}/static/chatbot/index.html`;
  const urlWithParams = new URL(url);

  urlWithParams.searchParams.append("config", JSON.stringify(config));

  // Create iframe element
  const iframe = document.createElement("iframe");
  iframe.src = urlWithParams;
  iframe.allowtransparency = true;
  iframe.title = "Chatbot Playground";
  iframe.style.border = "none";
  iframe.style.colorScheme = "normal";
  iframe.frameborder = "0"


  if (config.RENDER_TARGET_ID) {
    // poll for render target every second for 10 seconds
    let attempts = 0;
    const interval = setInterval(() => {
      const renderTarget = document.getElementById(config.RENDER_TARGET_ID);
      if (renderTarget) {
        iframe.style.position = "relative";
        iframe.width = "100%";
        iframe.height = "100%";
        renderTarget.appendChild(iframe);
        clearInterval(interval);
      }
      attempts++;
      if (attempts > 10) {
        clearInterval(interval);
      }
    }, 1000);
  } else {
    iframe.style.position = "fixed";
    iframe.style.right = "24px";
    iframe.style.bottom = "24px";
    iframe.style.zIndex = "9999";
    iframe.width = "80px";
    iframe.height = "80px";
    document.body.appendChild(iframe);
  }

  // Append iframe to body

  // Handle messages from iframe
  window.addEventListener("message", (event) => {
    if (event.origin !== origin) {
      return;
    }
    if (event.data.type === "resize" && !config.RENDER_TARGET_ID) {
      iframe.width = event.data.payload.width;
      iframe.height = event.data.payload.height;
      if (!event.data.payload.expanded) {
        iframe.style.maxWidth = "calc(100vw - 24px)";
        iframe.style.maxHeight = "calc(100vh - 24px)";
        iframe.style.right = "24px";
        iframe.style.bottom = "24px";
        iframe.style.left = "auto";
        iframe.style.top = "auto";
      } else {
        iframe.style.maxWidth = "100vw";
        iframe.style.maxHeight = "100vh";
        iframe.style.right = "0px";
        iframe.style.bottom = "0px";
        iframe.style.left = "0px";
        iframe.style.top = "0px";
      }
    }

    if (event.data.type === "openLink") {
      window.open(event.data.payload, "_blank");
    }
  });

  if (!config.RENDER_TARGET_ID) {
    // On click outside of the iframe, send close event
    document.addEventListener("click", (event) => {
      if (event.target !== iframe) {
        iframe.contentWindow.postMessage({ type: "close" }, "*");
      }
    });
  }
}

window.addEventListener("load", function(){
	// initGenAiChatbot();
	let img = document.createElement("img")
	img.classList.add('toc-item')
	img.style.paddingLeft = '16px'
	img.src = 'https://hitscounter.dev/api/hit?url=https%3A%2F%2Fdonaldzou.dev%2FWGDashboard-Documentation&label=Visitor&icon=book-fill&color=%23ff6c52'
	img.alt = 'Badge';
	let a = document.createElement('a')
	a.href = 'https://hitscounter.dev'
	a.target = '_blank'
	a.appendChild(img)
	
	let ele = document.querySelector('.toc')
	ele.appendChild(a);
	
	let e = document.querySelector('.wh-header__switchers');
	let pageBadge = document.createElement("div");
	pageBadge.style.display = 'flex'
	pageBadge.style.marginRight = '1rem'
	if (e){
		e.parentElement.insertBefore(pageBadge, e);
	}
	
	
	let body = document.querySelector("body");
	const config = { childList: true, subtree: true };
	let currentUrl = "";
	
	let insertDOLogo = false;
	let insertPageBadge = false;
	
	const callback = (mutationList, observer) => {
		if (!window.location.href.includes(currentUrl) || !currentUrl){
			console.log("URL Changed");
			currentUrl = window.location.href;
			insertDOLogo = false;
			insertPageBadge = false;
		}
		
		if (currentUrl.includes('index_topic.html')){
			pageBadge.innerHTML = '';
			if (!insertDOLogo){
				let e = document.querySelector('p[data-test="starting-page-subtitle"]')
				if (e){
					e.parentElement.innerHTML += `
						<div style="margin-top: 2rem">
							<hr>
							<h1 style="font-size: 1.5rem !important; margin-bottom: 0.5rem">This project is supported by</h1>
							 <a href="https://m.do.co/c/a84cb9aac585">
							    <img alt="" src="https://opensource.nyc3.cdn.digitaloceanspaces.com/attribution/assets/SVG/DO_Logo_horizontal_blue.svg" width="201px">
							 </a>
						</div>
					`;
					insertDOLogo = true;
				}
			}
		}else{
			if (!insertPageBadge){
				pageBadge.innerHTML = `
					<a href="https://hitscounter.dev">
					<img alt="Badge" src="https://hitscounter.dev/api/hit?url=${encodeURIComponent(window.location.href)}&label=Visits&icon=eye-fill&color=%231fbba1" /></a>
				`
				insertPageBadge = true
			}
		}
	};
	const observer = new MutationObserver(callback);
	observer.observe(body, config);
})
</script>